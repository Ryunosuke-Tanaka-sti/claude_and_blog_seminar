# ツール仕様書：[ツール名]

## 概要
[このツールの目的と概要を2-3文で説明]

## 背景・課題
[なぜこのツールが必要なのか、解決したい課題は何か]

例：
- ブログ記事の一覧ページを手作業で更新するのが面倒
- データ収集に毎回2時間かかっている
- ファイル形式の変換作業が頻繁に発生する

## ツールの目的
[このツールで自動化したい作業]

例：
- ブログ記事データ（JSON）から、見やすいHTMLインデックスページを自動生成する
- 指定したURLから記事データを収集し、構造化されたJSONファイルを生成する

## 入力仕様

### 入力データの形式
**ファイルパス**: `[入力ファイルのパス]`

**データ形式**:
```json
// JSON形式の場合
{
  "field1": "value1",
  "field2": "value2"
}
```

または

```
# その他の形式の場合
[ファイル内容の例]
```

### 入力データの検証ルール
- [必須フィールド]: [ルール]
- [任意フィールド]: [ルール]
- [データ型]: [期待される型]

例：
- `id`: 必須、文字列型、空文字不可
- `url`: 必須、URL形式、HTTPSのみ
- `date`: 任意、ISO8601形式

### 入力エラー時の挙動
- ファイルが存在しない場合: [処理]
- データ形式が不正な場合: [処理]
- 必須フィールドが欠けている場合: [処理]

例：
- ファイルが存在しない → エラーメッセージを表示して終了
- JSONパースエラー → エラー行を表示して終了
- 必須フィールドが欠けている → 該当レコードをスキップしてログ出力

## 処理内容

### 処理フロー
1. [ステップ1]
2. [ステップ2]
3. [ステップ3]
4. ...

例：
1. `docs/data/articles.json`を読み込む
2. 記事データを日付順（降順）にソート
3. HTMLテンプレートに記事データを埋め込む
4. `docs/blog-index.html`に書き込む
5. 成功メッセージを表示

### データ変換
```
入力データ → [変換処理1] → [変換処理2] → 出力データ
```

例：
```
JSON配列 → 日付でソート → HTMLリストに変換 → ファイル書き込み
```

### 条件分岐
- [条件A] の場合: [処理A]
- [条件B] の場合: [処理B]

例：
- 記事にサムネイル画像がある場合: `<img>`タグを生成
- 記事にサムネイル画像がない場合: デフォルト画像を使用

## 出力仕様

### 出力データの形式
**ファイルパス**: `[出力ファイルのパス]`

**データ形式**:
```
[出力ファイルの内容例]
```

### 出力ファイルの構造
```
出力ディレクトリ/
├── output-file-1.ext
├── output-file-2.ext
└── ...
```

### 出力エラー時の挙動
- ディレクトリが存在しない場合: [処理]
- 書き込み権限がない場合: [処理]
- ディスク容量不足の場合: [処理]

例：
- ディレクトリが存在しない → 自動的に作成
- 書き込み権限がない → エラーメッセージを表示して終了
- ディスク容量不足 → エラーメッセージを表示して終了

## エラーハンドリング

### 想定エラーケース
| エラーケース | 発生条件 | エラーメッセージ | 処理 |
|------------|---------|----------------|------|
| [エラー1] | [条件] | "[メッセージ]" | [処理] |
| [エラー2] | [条件] | "[メッセージ]" | [処理] |

例：
| エラーケース | 発生条件 | エラーメッセージ | 処理 |
|------------|---------|----------------|------|
| ファイル読み込みエラー | 入力ファイルが存在しない | "エラー: ファイル '{ファイル名}' が見つかりません" | 終了コード1で終了 |
| JSON パースエラー | JSON形式が不正 | "エラー: JSONのパースに失敗しました（行: {行番号}）" | 終了コード1で終了 |
| 書き込みエラー | 出力先に書き込めない | "エラー: ファイル '{ファイル名}' への書き込みに失敗しました" | 終了コード1で終了 |

### ログ出力
- **正常時**: [どのようなログを出力するか]
- **警告時**: [どのようなログを出力するか]
- **エラー時**: [どのようなログを出力するか]

例：
- 正常時: "✓ 処理が完了しました（処理件数: 20件、出力先: docs/blog-index.html）"
- 警告時: "⚠ スキップされた記事があります（記事ID: 123）"
- エラー時: "✗ エラーが発生しました: [詳細]"

## 実行方法

### コマンド
```bash
npm run [script-name] --workspace=application/tools
```

### 引数・オプション（ある場合）
```bash
npm run [script-name] -- --option1 value1 --option2 value2
```

**引数一覧:**
| 引数/オプション | 必須/任意 | デフォルト値 | 説明 |
|---------------|----------|------------|------|
| `--input` | 必須 | - | 入力ファイルパス |
| `--output` | 任意 | `docs/output.html` | 出力ファイルパス |
| `--verbose` | 任意 | false | 詳細ログを出力 |

### 実行例
```bash
# 例1: デフォルト設定で実行
npm run generate-index --workspace=application/tools

# 例2: オプション付きで実行
npm run generate-index --workspace=application/tools -- --verbose --output custom/path.html
```

## パフォーマンス要件

### 処理速度の目標
- [データ量] の処理を [時間] 以内に完了

例：
- 100件の記事データを5秒以内に処理
- 1000件の記事データを30秒以内に処理

### メモリ使用量
- [目標メモリ使用量]

例：
- 最大メモリ使用量: 100MB以内
- 大量データの場合はストリーム処理を検討

### 最適化の考慮事項
- [最適化すべきポイント]

例：
- 大量のファイルI/Oが発生する場合はバッチ処理
- 外部API呼び出しがある場合は並列化（レート制限に注意）

## 依存関係

### 使用するライブラリ
- [ライブラリ名]: [用途]

例：
- `cheerio`: HTMLパース
- `node-fetch`: HTTP リクエスト
- `commander`: CLI引数パース

### 外部サービス・API（ある場合）
- [サービス名]: [用途]
- [APIエンドポイント]: [説明]

例：
- `https://api.example.com/articles`: 記事データ取得API
- レート制限: 100リクエスト/分

## セキュリティ考慮事項

### 入力のサニタイズ
- [どのような入力をサニタイズするか]

例：
- ユーザー提供のファイルパスはパストラバーサル攻撃を防ぐ
- HTMLに埋め込むテキストはXSS対策のためエスケープ

### 機密情報の取り扱い
- [機密情報がある場合の扱い方]

例：
- APIキーは環境変数から読み込む（ハードコード禁止）
- 出力ファイルに機密情報を含めない

## テスト方法

### 動作確認の手順
1. [テストステップ1]
2. [テストステップ2]
3. [テストステップ3]

### 検証ポイント
- ✅ [確認項目1]
- ✅ [確認項目2]
- ✅ [確認項目3]

例：
- ✅ 出力ファイルが期待した場所に生成されているか
- ✅ 出力データの件数が入力データと一致しているか
- ✅ エラー時に適切なメッセージが表示されるか
- ✅ 処理が5秒以内に完了しているか

### テストデータ
```
# テストデータの例
[テストに使用するデータ]
```

## 実装時の注意点

### 優先度
- 🔴 必須: [絶対に実装が必要な機能]
- 🟡 推奨: [可能であれば実装したい機能]
- 🟢 オプション: [余裕があれば実装]

例：
- 🔴 必須: 基本的なデータ変換処理
- 🔴 必須: エラーハンドリング
- 🟡 推奨: 詳細ログ出力（--verboseオプション）
- 🟡 推奨: 進捗バーの表示
- 🟢 オプション: 設定ファイルからのオプション読み込み

### 実装順序
1. [最初に実装すべき部分]
2. [次に実装すべき部分]
3. [最後に実装すべき部分]

例：
1. 入力ファイルの読み込みと検証
2. コアとなるデータ変換ロジック
3. 出力ファイルへの書き込み
4. エラーハンドリング
5. ログ出力の整備

### 既存コードとの関係
- [既存ツールとの関係]

例：
- `scraper.ts`が生成したデータを入力として使用
- `blog-html-generator.ts`と処理を共通化できる部分がある

## AIへの依頼事項

```
以下の仕様書を読み込んでツールを実装してください：
@docs/features/[このファイル名].md

実装方針：
- 入力/出力の正確性を最優先
- エラーハンドリングを適切に実装
- 実行時に進捗が分かるようログ出力を追加
- TypeScriptの型安全性を活用
```

## 制約事項

### 技術的制約
- Node.js バージョン: [X.X.X以上]
- TypeScript バージョン: [X.X.X以上]
- [その他の制約]

### 環境制約
- [実行環境の制約]

例：
- Linuxでのみ動作（Windowsは未サポート）
- インターネット接続が必要（オフライン動作不可）

## 参考資料
- [関連する仕様書]
- [参考にしたツールやライブラリ]
- [外部API仕様]

## 備考
[その他、実装時に知っておくべき情報]

---

## 仕様書レビューチェックリスト

実装前に以下を確認してください：

- [ ] 入力データの形式が明確に定義されているか
- [ ] 出力データの形式が明確に定義されているか
- [ ] 処理フローが具体的に記述されているか
- [ ] 想定されるエラーケースが網羅されているか
- [ ] 実行方法が明確に記述されているか
- [ ] テスト方法が具体的に記述されているか
- [ ] 実装の詳細（アルゴリズム）を書いていないか
