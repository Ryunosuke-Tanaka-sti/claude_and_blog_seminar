# 仕様書ベース開発ガイド（このリポジトリ専用版）

## 概要

このガイドでは、Claude Codeを活用した3フェーズ開発手法を、このリポジトリの構成（Marp、Frontend、Tools）に最適化して説明します。この手法により、開発時間を大幅に短縮し、意図した通りの実装を実現できます。

## このリポジトリの特徴

### リポジトリ構成
このリポジトリは3つのワークスペースから構成されています：

```
/
├── application/
│   ├── marp/           # プレゼンテーションスライド
│   ├── frontend/       # Webサイト（Astro + React）
│   └── tools/          # ユーティリティツール（TypeScript）
└── docs/               # 仕様書・ドキュメント
```

### 開発アプローチの特徴
**AIデザイン駆動**: UI/UXの細かいデザインはAIに任せ、人間は**情報設計**に注力します。

- 従来のアプローチ: 「タイトルは32px、色は#333333で...」と詳細に指定
- このリポジトリ: 「タイトルを最も目立たせる、次にサムネイル画像...」と情報の優先度を指定

## 3フェーズ開発とは

開発を「**計画**」「**実装**」「**検証**」の3つのフェーズに分けることで、AIとの協働開発を効率化する手法です。

```
計画フェーズ → 実装フェーズ → 検証フェーズ
   (仕様書)      (コード)      (差分分析)
```

### 従来手法との比較

| 項目 | Before（ペアコーディング） | After（3フェーズ開発） |
|------|---------------------------|---------------------|
| 仕様検討 | 開発中に随時（割り込み多数） | 事前に1-2時間 |
| 開発時間 | 1週間 | 2日 |
| 手戻り回数 | 平均3-4回 | 平均1回 |
| デザイン調整 | 無限ループ | AIに委ねて0回 |

## ディレクトリ構造（このリポジトリ版）

```
/
├── CLAUDE.md                           # プロジェクト全体のガイドライン
├── docs/                               # 計画・設計・検証フェーズ
│   ├── CLAUDE.md                       # 計画フェーズ専用ルール
│   ├── features/                       # 新機能の計画書（ディレクトリ単位）
│   │   ├── frontend-[name]/            # フロントエンド機能
│   │   │   ├── spec.md                 # 仕様書
│   │   │   ├── plan.md                 # 実装計画書
│   │   │   └── assets/                 # 図表・画像（任意）
│   │   ├── marp-[name]/                # Marpスライド
│   │   │   ├── spec.md
│   │   │   └── plan.md
│   │   └── tool-[name]/                # ツール開発
│   │       ├── spec.md
│   │       └── plan.md
│   ├── bugs/                           # バグ調査・修正計画（ディレクトリ単位）
│   │   └── [bug-name]/
│   │       ├── spec.md                 # バグ調査・修正仕様書
│   │       └── plan.md                 # 修正計画書
│   ├── research/                       # 検証結果・知見
│   │   └── [topic]-review.md           # 実装レビュー結果
│   └── templates/                      # 仕様書テンプレート
│       ├── README.md                   # テンプレート使用方法
│       ├── spec-template-*.md          # 仕様書テンプレート
│       └── CLAUDE-*.md                 # 各フェーズ用CLAUDE.md
└── application/                        # 実装フェーズ
    ├── marp/                           # プレゼンテーションスライド
    │   ├── CLAUDE.md                   # Marp実装ルール
    │   ├── src/                        # スライドMarkdownファイル
    │   ├── templates/                  # スライドテンプレート
    │   └── theme/                      # CSSテーマ
    ├── frontend/                       # Webサイト（Astro + React）
    │   ├── CLAUDE.md                   # フロントエンド実装ルール
    │   └── src/                        # ソースコード
    └── tools/                          # ユーティリティツール
        ├── CLAUDE.md                   # ツール実装ルール
        ├── *.ts                        # ツールスクリプト
        └── dist/                       # ビルド出力
```

## フェーズ別の使用方法

### 1. 計画フェーズ（`docs/`配下で作業）

**目的**: AIに人間の意図を適切に伝える仕様書を作成する

#### CLAUDE.mdの設定

`docs/CLAUDE.md`に以下の内容を記述します：

```markdown
# 設計フェーズのルール

## 目的
AIに人間の意図を適切に伝えて効率的な開発を行う

## 設計フェーズで行うこと
- 型定義の設計
- データベース構造の設計
- API 仕様の定義
- アーキテクチャ設計
- 機能要件の明確化
- 非機能要件の定義

## 設計フェーズで禁止すること
- ❌ 実装コードの記述禁止
- ❌ 具体的なロジックの記述禁止
- ❌ **デザインの詳細指定禁止**（色、フォントサイズ、レイアウトなど）
- ❌ 具体的な関数実装禁止

## 設計フェーズで重視すること（AIデザイン駆動）
- ✅ **情報設計**: 何を表示するか、優先度は何か
- ✅ 機能要件の明確化
- ✅ データ構造の設計
- ✅ インタラクションの定義（何をクリックするとどうなるか）

## レビューポイント
- 要件の抜け漏れはないか
- 設計の整合性は取れているか
- スケーラビリティは考慮されているか
- セキュリティ要件は満たしているか
```

#### 仕様書作成の手順

1. **要件の整理**: 何を作りたいかを箇条書きで整理
2. **AIとの対話**: CLAUDE.mdのルールに基づいて仕様書を依頼
3. **レビューと修正**: 作成された仕様書を人間の視点でレビュー
4. **反復改善**: 不足部分や曖昧な部分を繰り返し修正

#### 仕様書テンプレート

`docs/templates/`から適切なテンプレートを選んでコピーします：

| テンプレート | 用途 | コピー先 |
|------------|------|---------|
| `spec-template-frontend.md` | フロントエンド機能 | `docs/features/frontend-[name]/spec.md` |
| `spec-template-marp.md` | Marpスライド | `docs/features/marp-[name]/spec.md` |
| `spec-template-tool.md` | ツール開発 | `docs/features/tool-[name]/spec.md` |
| `spec-template-feature.md` | 汎用機能 | `docs/features/[name]/spec.md` |
| `spec-template-bug.md` | バグ修正 | `docs/bugs/[bug-name]/spec.md` |

**例（フロントエンド機能）:**
```bash
# ディレクトリ作成
mkdir -p docs/features/frontend-blog-index

# テンプレートコピー
cp docs/templates/spec-template-frontend.md docs/features/frontend-blog-index/spec.md
```

### 2. 実装フェーズ（`application/`配下で作業）

**目的**: 作成した仕様書を元に実装を行う

#### CLAUDE.mdについて

各ワークスペースには既にCLAUDE.mdが配置されています：

- `application/marp/CLAUDE.md` - Marpスライド実装ルール
- `application/frontend/CLAUDE.md` - フロントエンド実装ルール（Astro+React）
- `application/tools/CLAUDE.md` - ツール実装ルール（TypeScript）

実装フェーズでは、該当するワークスペースのCLAUDE.mdをAIに読み込ませて使用します。

#### 実装の手順（共通）

1. **仕様書の読み込み**: `docs/features/[feature-name]/`から該当する仕様書を指定
2. **AIに実装依頼**（例：フロントエンド）:
   ```
   以下の仕様書を読み込んで実装してください：
   @docs/features/frontend-blog-index/spec.md

   実装方針：
   - 表示する情報の正確性・網羅性を最優先
   - UI/UXデザインはあなたの判断で最適なものを選択
   - モダンで見やすいデザインを心がけてください
   ```
3. **監視と修正**: 人間は監視役に徹し、AIが暴走した場合は小さなプロンプトで修正
4. **ビルド確認**: 実装後にビルドが通ることを確認

#### ワークスペース別の実装ポイント

##### Marp（プレゼンテーションスライド）
```bash
# ビルド
npm run build:marp

# レビューポイント
# ✅ 伝えたいメッセージが明確か
# ✅ 情報の順序が論理的か
# ✅ 図解が分かりやすいか
# 🤖 色やフォントは気にしない
```

##### Frontend（Webサイト）
```bash
# 開発サーバー起動
npm run dev:frontend

# ビルド
npm run build:frontend

# レビューポイント
# ✅ 表示される情報は正しいか
# ✅ 必要な情報が全て表示されているか
# ✅ 情報の優先度は適切か
# 🤖 デザインの好みは気にしない
```

##### Tools（ユーティリティツール）
```bash
# 実行
npm run [tool-script] --workspace=application/tools

# レビューポイント
# ✅ 出力ファイルは期待通りか
# ✅ エラー時に適切なメッセージが表示されるか
# ✅ 実行速度は許容範囲か
# 🤖 コードの書き方は気にしない
```

### 3. 検証フェーズ（`docs/research/`配下で作業）

**目的**: 計画と実装の差異を分析し、学びを得る

#### 検証の手順

1. **差異分析の依頼**:
   ```
   @docs/features/frontend-blog-index/spec.md の計画ドキュメントと
   @application/frontend/src/ の実装内容を確認して、
   計画と実装の差異がある点をまとめてください。
   ```

2. **結果の保存**: 分析結果を`docs/research/`に保存
   ```markdown
   # 実装レビュー：ブログ一覧ページ

   ## 計画との差異
   - [差異1]
   - [差異2]

   ## 仕様書の不備
   - [不足していた要件]

   ## 学んだこと
   - [次回に活かせる知見]
   ```

3. **次回への改善**: 仕様漏れがあった箇所を特定し、次回の計画フェーズに活かす

## 実践での注意点

### この手法が向いている作業

- ✅ バックエンドのAPI開発（仕様が明確に定義しやすい）
- ✅ データ処理ロジック（入力と出力が明確）
- ✅ 既存プロジェクトへの機能追加（コード規約が決まっている）
- ✅ プロトタイピング（スピード重視）

### この手法が向いていない作業

- ❌ プロジェクト構造の大幅変更（パスの解決に時間がかかる）
- ❌ 簡単なリネーム作業（人間の手作業の方が早い）
- ❌ 1-2行の小さな修正（仕様書を書く方が時間がかかる）

### フロントエンドのアプローチ（このリポジトリの特徴）

**従来の問題点**: UIを文章で説明すると分量が膨大になり、デザイン調整が無限ループ化

**このリポジトリの解決策**: **AIデザイン駆動**
- 人間は**情報設計**に注力（何を、どの順で表示するか）
- デザインの詳細（色、フォント、レイアウト）はAIに完全に委ねる
- 「デザインの好み」という主観を排除し、情報の正確性を重視

→ フロントエンドも仕様書ベース開発が可能に！

### AIの"忘れっぽさ"への対処

CLAUDE.mdの設定を忘れることがあります：

**対処法1: リアルタイム修正**
- 動作を確認しながら進める
- 意図した挙動をしていない瞬間に処理を止める
- プロンプトに守ってほしい原則を改めて追加して再実行

**対処法2: 事後確認**
- 処理完了後に「原則守ってないですよね？」と確認
- なぜその判断をしたのかを確認
- 次回の改善につなげる

## 実際の開発効果

### 小規模システムの例
- バックエンドのエンドポイント2つ
- フロントエンドの画面1つ
- **開発時間：約30分で完了**

### 中規模システムの限界
- エンドポイント4つ以上になるとセッションが限界になることも
- タスクを適切に分割する必要がある

## バグと仕様漏れ

### バグ発生率
- バグというより**仕様漏れ**の方が圧倒的に多い
- ビルドエラーはフォーマッター/リンターで防げる
- 情報設計の漏れ（「この情報も表示すべきだった」）が主な問題

### 学習効果
- AIが返してきた仕様書から学べる
- レビュー観点を育てることができる
- 完璧な仕様書は存在しないが、段階的に改善できる
- **情報設計のスキル**が自然と向上する

## このリポジトリ特有の tips

### 1. Marpスライド作成のコツ
- ブログ記事の全内容をスライドにしない（重要ポイントのみ抽出）
- 1スライド1メッセージの原則を守る
- 図解が必要な箇所を仕様書で明確にする

### 2. フロントエンド開発のコツ
- 「表示する情報」セクションを最も詳細に書く
- 情報の優先度（最重要・重要・補足）を明確にする
- デザインの詳細は一切書かない（AIに任せる）

### 3. ツール開発のコツ
- 入力・出力の形式を具体例で示す
- エラーケースを網羅的にリストアップ
- 実行方法とテスト方法を明確にする

### 4. AIデザイン駆動のメリット
- デザインの微調整で時間を浪費しない
- 「ここの色が気に入らない」という主観的な議論を回避
- 情報が正しく伝わることに集中できる
- アクセシビリティがAIによって自動的に考慮される

## まとめ

### 3フェーズ開発手法のポイント

1. **計画フェーズ**: `docs/`配下で仕様書を作成（コードは書かない）
   - 情報設計を重視
   - デザインの詳細は書かない

2. **実装フェーズ**: `application/`配下で仕様書を元に実装
   - Marp: メッセージの明確さを重視
   - Frontend: 情報の正確性・網羅性を重視
   - Tools: 入力/出力の正確性を重視

3. **検証フェーズ**: `docs/research/`で差異を分析し、学びを得る
   - 情報設計の改善ポイントを発見
   - 次回の仕様書に反映

### この手法により実現すること

- 開発時間を1週間→2日に短縮
- 手戻り回数を3-4回→1回に削減
- デザイン調整の無限ループを0回に
- AIとの協働によるレビュー経験の獲得
- **情報設計スキルの向上**

### このリポジトリでの適用範囲

| ワークスペース | 適用度 | ポイント |
|-------------|--------|---------|
| **Marp** | ⭐⭐⭐⭐⭐ | メッセージ設計に注力、デザインはAIに任せる |
| **Frontend** | ⭐⭐⭐⭐⭐ | 情報設計に注力、UI/UXはAIに任せる |
| **Tools** | ⭐⭐⭐⭐⭐ | 入出力仕様を明確に、実装詳細はAIに任せる |

**全てのワークスペースで仕様書ベース開発が効果的！**

### 次のステップ

1. `docs/templates/`からテンプレートを選んでコピー
2. 小さな機能から始めてみる（1-2時間で完了する規模）
3. 検証フェーズで学びを得る
4. テンプレートやCLAUDE.mdを改善
5. 次の機能開発で改善版を使用

**重要**: 完璧を目指さず、段階的に改善していくことが成功の鍵です。
